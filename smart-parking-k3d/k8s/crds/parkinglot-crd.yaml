# CustomResourceDefinition per ParkingLot
# Definisce una risorsa personalizzata "ParkingLot" per gestire lo stato di un parcheggio in Kubernetes
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  # Nome della risorsa CRD (deve essere univoco)
  name: parkinglots.parking.smart
spec:
  # Gruppo API custom (namespace logico per le risorse personalizzate)
  group: parking.smart
  # Scope: la risorsa Ã¨ visibile solo nel namespace in cui viene creata
  scope: Namespaced
  names:
    # Plurale, singolare, tipo e abbreviazione della risorsa
    plural: parkinglots
    singular: parkinglot
    kind: ParkingLot
    shortNames: [plot]
  versions:
  - name: v1alpha1
    # Versione API della CRD
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          # Sezione spec: dati di configurazione del parcheggio
          spec:
            type: object
            properties:
              # Identificativo del parcheggio
              lotId: { type: string }
              # Numero totale di stalli
              totalSpaces: { type: integer }
            required: ["lotId","totalSpaces"]
          # Sezione status: stato aggiornato dal controller/aggregator
          status:
            type: object
            properties:
              # Numero di stalli occupati
              occupied: { type: integer }
              # Numero di stalli liberi
              free: { type: integer }
              # Timestamp dell'ultimo aggiornamento
              lastUpdate: { type: string, format: date-time }
    subresources:
      # Abilita la sottorisorsa status (aggiornabile separatamente)
      status: {}
