# CustomResourceDefinition per ParkingSpace
# Definisce una risorsa personalizzata "ParkingSpace" per gestire lo stato di uno stallo di parcheggio in Kubernetes
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  # Nome della risorsa CRD (deve essere univoco)
  name: parkingspaces.parking.smart
spec:
  # Gruppo API custom (namespace logico per le risorse personalizzate)
  group: parking.smart
  # Scope: la risorsa è visibile solo nel namespace in cui viene creata
  scope: Namespaced
  names:
    # Plurale, singolare, tipo e abbreviazione della risorsa
    plural: parkingspaces
    singular: parkingspace
    kind: ParkingSpace
    shortNames: [pspace]
  versions:
  - name: v1alpha1
    # Versione API della CRD
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          # Sezione spec: dati identificativi dello stallo
          spec:
            type: object
            properties:
              # Identificativo del parcheggio
              lotId: { type: string }
              # Identificativo dello stallo
              spaceId: { type: string }
            required: ["lotId","spaceId"]
          # Sezione status: stato aggiornato dal controller/aggregator
          status:
            type: object
            properties:
              # True se lo stallo è occupato, false se libero
              occupied: { type: boolean }
              # Timestamp dell'ultimo messaggio ricevuto dal sensore
              lastSeen: { type: string, format: date-time }
              # True se il sensore è online, false se offline (LWT MQTT)
              sensorOnline: { type: boolean }
    subresources:
      # Abilita la sottorisorsa status (aggiornabile separatamente)
      status: {}
