# RBAC per i componenti Mobile API e Signage
# Permette la lettura delle CRD ParkingLot e ParkingSpace

# ServiceAccount usato dal pod Mobile API
apiVersion: v1
kind: ServiceAccount
metadata:
  name: mobile-api
---
# ServiceAccount usato dal pod Signage
apiVersion: v1
kind: ServiceAccount
metadata:
  name: signage
---
# Ruolo con permessi di sola lettura sulle CRD ParkingLot e ParkingSpace
# Include i permessi get/list/watch per monitorare gli oggetti
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: crd-reader
rules:
  - apiGroups: ["parking.smart"]                 # Gruppo API custom definito dalle CRD
    resources: ["parkinglots","parkingspaces"]   # Risorse gestite
    verbs: ["get","list","watch"]                # Permessi di sola lettura
---
# RoleBinding che collega il ServiceAccount mobile-api al ruolo crd-reader
# In questo modo Mobile API pu√≤ leggere le CRD
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: mobile-api-crd-rb
subjects:
  - kind: ServiceAccount
    name: mobile-api                             # Nome del ServiceAccount associato
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: crd-reader                               # Nome del ruolo con i permessi
---
# RoleBinding che collega il ServiceAccount signage al ruolo crd-reader
# Permette anche a Signage di leggere le CRD
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: signage-crd-rb
subjects:
  - kind: ServiceAccount
    name: signage                                # Nome del ServiceAccount associato
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: crd-reader                               # Riferimento al ruolo di lettura
